# 台灣證券交易所三大法人買賣超爬蟲

## 專案簡介

本專案提供一個Python爬蟲程式，用於抓取台灣證券交易所（TWSE）的三大法人買賣超日報資料。透過證交所官方API，自動化取得指定日期的三大法人（外資、投信、自營商）交易資訊。

## 功能特點

- 使用官方JSON API端點，資料準確可靠
- 支援自訂查詢日期（民國101年5月2日起的歷史資料）
- 自動解析並格式化顯示19個欄位的完整交易資料
- 預設抓取買賣超前10名股票，可自訂數量
- 完整的錯誤處理機制
- 清晰的終端輸出格式

## 系統需求

- Python 3.6 或以上版本
- 網路連線

## 安裝說明

### 1. 建立虛擬環境（建議）

```bash
python3 -m venv venv
source venv/bin/activate  # macOS/Linux
# 或
venv\Scripts\activate  # Windows
```

### 2. 安裝相依套件

```bash
pip install requests urllib3
```

## 使用方法

### 基本使用

```bash
python twse_crawler.py
```

### 自訂日期查詢

編輯 `twse_crawler.py` 檔案，修改以下部分：

```python
# 修改日期格式為 YYYYMMDD
date = "20251023"  # 例如：2025年10月23日
```

## 資料欄位說明

每筆資料包含以下19個欄位：

| 欄位名稱 | 說明 |
|---------|------|
| 證券代號 | 股票代碼 |
| 證券名稱 | 股票名稱 |
| 外陸資買進股數(不含外資自營商) | 外資及陸資買進的股數 |
| 外陸資賣出股數(不含外資自營商) | 外資及陸資賣出的股數 |
| 外陸資買賣超股數(不含外資自營商) | 外資及陸資買賣超（正值為買超，負值為賣超） |
| 外資自營商買進股數 | 外資自營商買進的股數 |
| 外資自營商賣出股數 | 外資自營商賣出的股數 |
| 外資自營商買賣超股數 | 外資自營商買賣超 |
| 投信買進股數 | 投信買進的股數 |
| 投信賣出股數 | 投信賣出的股數 |
| 投信買賣超股數 | 投信買賣超 |
| 自營商買賣超股數 | 自營商總買賣超 |
| 自營商買進股數(自行買賣) | 自營商自行買賣的買進股數 |
| 自營商賣出股數(自行買賣) | 自營商自行買賣的賣出股數 |
| 自營商買賣超股數(自行買賣) | 自營商自行買賣的買賣超 |
| 自營商買進股數(避險) | 自營商避險交易的買進股數 |
| 自營商賣出股數(避險) | 自營商避險交易的賣出股數 |
| 自營商買賣超股數(避險) | 自營商避險交易的買賣超 |
| 三大法人買賣超股數 | 外資、投信、自營商的總買賣超 |

## 輸出範例

```
====================================================================================================
台灣證券交易所 - 三大法人買賣超日報爬蟲
====================================================================================================
正在抓取 20251023 的三大法人買賣超資料...

欄位說明:
['證券代號', '證券名稱', '外陸資買進股數(不含外資自營商)', ...]

總共抓取到 10 筆資料（前10筆）:
====================================================================================================

第 1 筆資料:
  證券代號: 2337
  證券名稱: 旺宏
  外陸資買進股數(不含外資自營商): 56,115,550
  外陸資賣出股數(不含外資自營商): 22,708,390
  外陸資買賣超股數(不含外資自營商): 33,407,160
  ...
  三大法人買賣超股數: 31,813,557
----------------------------------------------------------------------------------------------------

✓ 資料抓取成功！
```

## 程式架構

```
twse_crawler.py
├── fetch_institutional_investors_data()  # 主要函式
│   ├── 設定API端點和參數
│   ├── 發送HTTP請求
│   ├── 解析JSON資料
│   ├── 格式化輸出結果
│   └── 錯誤處理
└── main  # 主程式進入點
```

## 進階設定

### 修改抓取筆數

在 `twse_crawler.py` 中找到以下程式碼：

```python
# 取得前10筆資料
records = data['data'][:10]
```

修改 `[:10]` 為所需的筆數，例如：
- `[:20]` - 抓取前20筆
- `[:]` - 抓取全部資料

### 修改查詢類型

目前預設查詢所有股票（`selectType='ALL'`），可修改為：

```python
params = {
    'date': date_str,
    'selectType': 'ALLBUT0999',  # 全部(不含權證、牛熊證、可展延牛熊證)
    'response': 'json'
}
```

## 注意事項

1. **日期格式**：必須使用 `YYYYMMDD` 格式（例如：20251023）
2. **資料範圍**：僅提供民國101年5月2日（2012/05/02）之後的資料
3. **交易日限制**：僅能查詢有交易的營業日資料，假日或非交易日將無資料
4. **SSL證書**：程式已設定 `verify=False` 以避免SSL驗證問題
5. **請求頻率**：建議不要過度頻繁請求，以免對伺服器造成負擔

## 常見問題

### Q1: 執行時出現 "查無資料或該日期無交易資料"

**A:** 請確認：
- 日期格式是否正確（YYYYMMDD）
- 該日期是否為營業日（非假日、週末）
- 日期是否在民國101年5月2日之後

### Q2: 出現 SSL 錯誤

**A:** 程式已內建處理SSL錯誤，如仍有問題請確認：
- 網路連線是否正常
- 防火牆設定是否阻擋連線

### Q3: ModuleNotFoundError: No module named 'requests'

**A:** 請先安裝必要套件：
```bash
pip install requests urllib3
```

### Q4: 如何儲存資料到檔案？

**A:** 可在程式中新增以下程式碼將資料儲存為JSON或CSV：

```python
import json

# 儲存為JSON
with open('data.json', 'w', encoding='utf-8') as f:
    json.dump(records, f, ensure_ascii=False, indent=2)

# 或使用pandas儲存為CSV
import pandas as pd
df = pd.DataFrame(records)
df.to_csv('data.csv', index=False, encoding='utf-8-sig')
```

## API 來源

- 資料來源：台灣證券交易所（TWSE）
- API端點：`https://www.twse.com.tw/rwd/zh/fund/T86`
- 官方網站：https://www.twse.com.tw/

## 授權聲明

本專案僅供學習與研究使用，資料版權屬於台灣證券交易所所有。使用時請遵守證交所的使用規範。

## 作者

- 建立日期：2025年10月26日
- 用途：台灣證券交易所三大法人買賣超資料爬蟲

## 更新紀錄

- v1.0.0 (2025/10/26)
  - 初始版本
  - 支援三大法人買賣超日報查詢
  - 完整19欄位資料輸出
  - 前10筆資料展示功能
